\section{Elliptic Curve Arithmetic}
\label{section:ec}
\textbf{WIP}

\subsection{Addition}

\begin{center}
\begin{table}[H]
\begin{tabular}{llllllllllllllll}
 Row  & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 \\
 $i$ 	  & $x_1$ & $y_1$ & $x_2$ & $y_2$ & $x_3$ & $y_3$ & $r$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ \\
\end{tabular}
\end{table}
\end{center}

Constraints:
\begin{itemize}
	\item $(x_2 - x_1) \cdot (y_3 + y_1) - (y_1 - y_2) \cdot (x_1 - x_3)$
	\item $(x_1 + x_2 + x_3) \cdot (x_1 - x_3) \cdot (x_1 - x_3) - (y_3 + y_1) \cdot (y_3 + y_1)$
	\item $(x_2 - x_1) \cdot r = 1$
\end{itemize}

\subsection{Doubling and Tripling}

\begin{center}
\begin{table}[H]
\begin{tabular}{llllllllllllllll}
 Row  & 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 \\
 $i$ 	  & $x_1$ & $y_1$ & $x_2$ & $y_2$ & $x_3$ & $y_3$ & $r_1$ & $r_2$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ \\
\end{tabular}
\end{table}
\end{center}

Constraints:
\begin{itemize}
	\item Doubling:
	\begin{itemize}
		\item $4 \cdot y_1^2 \cdot (x_2 + 2 \cdot x_1) = 9 \cdot x_1^4$
		\item $2 \cdot y_1 \cdot (y_2 + y_1) = (3 \cdot x_1^2) \cdot (x_1 - x_2)$
		\item $y_1 \cdot r_1 = 1$
	\end{itemize}
	\item Addition (for tripling):
	\begin{itemize}
		\item $(x_2 - x_1) \cdot (y_3 + y_1) - (y_1 - y_2) \cdot (x_1 - x_3)$
		\item $(x_1 + x_2 + x_3) \cdot (x_1 - x_3) \cdot (x_1 - x_3) - (y_3 + y_1) \cdot (y_3 + y_1)$
		\item $(x_2 - x_1) \cdot r_2 = 1$
	\end{itemize}
\end{itemize}


\subsection{Variable Base Scalar Multiplication}
For $S  = [r]T$, where $r = 2^n + k$ and $k = [k_n ... k_0]$, $k_i \in \{0, 1\}$:
\footnote{Using the results from \url{https://arxiv.org/pdf/math/0208038.pdf}}
\begin{enumerate}
	\item $S = [2]T$
	\item for $i$ from $n - 1$ to $0$:
	\begin{enumerate}
		\item $Q = k_{i + 1} \: ? \: T : -T$\
		\item $R = S + Q$
		\item $S = R + S$
	\end{enumerate}
	\item $S = k_0 \: ? \: S - T : S$
\end{enumerate}

\begin{center}
\begin{table}[H]
\begin{tabular}{llllllllllllllll}
 Row 		& 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 \\
 $i$ 			& $x_T$ & $y_T$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n=0$ & $x_R$ & $y_R$ & $s_1$ & $s_2$ & $b_1$ & $s_3$ & $s_4$ & $b_2$ \\
 $i + 1$	& $s_5$ & $b_3$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $x_V$ & $y_V$ & $s_1$ & $b_1$ & $s_3$ & $b_2$ \\
 $\vdots$	& $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ \\
 $i + 100$	& $x_T$ & $y_T$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $s_1$ & $s_2$ & $b_1$ & $s_3$ & $s_4$ & $b_2$ \\
 $i + 101$	& $s_5$ & $b_3$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $x_V$ & $y_V$ & $s_1$ & $b_1$ & $s_3$ & $b_2$ \\
\end{tabular}
\end{table}
\end{center}

Constraints:
\begin{itemize}
	\item $b_1 \cdot (b_1 - 1) = 0$
	\item $b_2 \cdot (b_2 - 1) = 0$
	\item $(x_P - x_T) \cdot s_1 = y_P - (2b_1 - 1) \cdot y_T$
	\item $s_1^2 - s_2^2 = x_T - x_R$
	\item $(2 \cdot x_P + x_T - s_1^2) \cdot (s_1 + s_2) = 2y_P$
	\item $(x_P - x_R) \cdot s_2 = y_R + y_P$
	\item $(x_R - x_T) \cdot s_3 = y_R - (2b_2 - 1) \cdot y_T$
	\item $s_3^2 - s_4^2 = x_T - x_S$
	\item $(2 \cdot x_R + x_T - s_3^2) \cdot (s_3 + s_4) = 2 \cdot y_R$
	\item $(x_R - x_S) \cdot s_4 = y_S + y_R$
	\item $n = 32 \cdot \texttt{next}(n) + 16 \cdot b_1 + 8 \cdot b_2 + 4 \cdot \texttt{next}(b_1) + 2 \cdot \texttt{next}(b_2) + \texttt{next}(b_3)$
\end{itemize}

\subsection{Variable Base Endo-Scalar Multiplication}

For $S  = [r]T$, where $r = [r_n ... r_0]$ and $r_i \in \{0, 1\}$:
\footnote{Using the results from \url{https://eprint.iacr.org/2019/1021.pdf}}
\begin{enumerate}
	\item $S = [2](\phi(T) + T)$
	\item for $i$ from $\frac{n}{2} - 1$ to $0$:
	\begin{enumerate}
		\item $Q = r_{2i + 1} \: ? \: \phi([2r_{2i} - 1]T) : [2r_{2i} - 1]T$
		\item $R = S + Q$
		\item $S = R + S$
	\end{enumerate}
\end{enumerate}

\begin{center}
\begin{table}[H]
\begin{tabular}{llllllllllllllll}
 Row 		& 0 & 1 & 2 & 3 & 4 & 5 & 6 & 7 & 8 & 9 & 10 & 11 & 12 & 13 & 14 \\
 $i$ 			& $x_T$ & $y_T$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $s_1$ & $s_3$ & $b_1$ & $b_2$ & $b_3$ & $b_4$ \\
 $i + 1$	& $s_5$ & $b_3$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $s_1$ & $s_3$ & $b_1$ & $b_2$ & $b_3$ & $b_4$ \\
 $\vdots$	& $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ & $\vdots$ \\
 $i + 62$	& $x_T$ & $y_T$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $s_1$ & $s_3$ & $b_1$ & $b_2$ & $b_3$ & $b_4$ \\
 $i + 63$	& $s_5$ & $b_3$ & $x_S$ & $y_S$ & $x_P$ & $y_P$ & $n$ & $x_R$ & $y_R$ & $s_1$ & $s_3$ & $b_1$ & $b_2$ & $b_3$ & $b_4$ \\
\end{tabular}
\end{table}
\end{center}

Constraints:
\begin{itemize}
	\item $b_1 \cdot (b_1 - 1) = 0$
	\item $b_2 \cdot (b_2 - 1) = 0$
	\item $b_3 \cdot (b_3 - 1) = 0$
	\item $b_4 \cdot (b_4 - 1) = 0$
	\item $((1 + (\texttt{endo} - 1) \cdot b_2) \cdot x_T - x_P) \cdot s_1 = (2 \cdot b_1 - 1) \cdot y_T - y_P$
	\item $(2 \cdot x_P - s_1^2 + (1 + (\texttt{endo} - 1) \cdot b_2) \cdot x_T) \cdot ((x_P - x_R) \cdot s_1 + y_R + y_P) = (x_P - x_R) \cdot 2 \cdot y_P$
	\item $(y_R + yP)^2 = (xP - x_R)^2 \cdot (s_1^2 - (1 + (\texttt{endo} - 1) \cdot b_2) \cdot x_T + x_R)$
	\item $((1 + (\texttt{endo} - 1) \cdot b_2) \cdot x_T - x_R) \cdot s_3 = (2 \cdot b_3-1) \cdot y_T - y_R$
	\item $(2 \cdot x_R - s_3^2 + (1 + (\texttt{endo} - 1) \cdot b_4) \cdot x_T) \cdot ((x_R - x_S) \cdot s_3 + y_S + y_R) = (x_R - x_S) \cdot 2 \cdot y_R$
	\item $(y_S + y_R)^2 = (x_R - x_S)^2 \cdot (s_3^2 - (1 + (\texttt{endo} - 1) \cdot b_4) \cdot x_T + x_S)$
	\item $n = 16 \cdot \texttt{next}(n) + 8 \cdot b_1 + 4 \cdot b_2 + 2 \cdot b_3 + b_4$
\end{itemize}